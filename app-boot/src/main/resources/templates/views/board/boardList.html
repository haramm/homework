<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layout/main_layout}">
<th:block layout:fragment="css">
    <style>
        .contents {
            margin: 0 auto;
            width: 100%;
            height: 100vh;
        }
        .dataTables {
            table-layout: fixed;
        }
    </style>
</th:block>
<div layout:fragment="content">
    <main class="container">
        <section class="contents">
            <header class="text-center">
                <h2> 게시판 리스트 </h2>
            </header>
            <section class="text-end">
                <button type="button" class="btn btn-success" onclick="writeBoard()">글쓰기</button>
            </section>
            <section class="table-list">
                <table id="boardTable">
                    <thead>
                        <tr>
                            <th scope="col">번호</th>
                            <th scope="col">글제목</th>
                            <th scope="col">작성자</th>
                            <th scope="col">조회수</th>
                            <th scope="col">추천수</th>
                            <th scope="col">수정날짜</th>
                        </tr>
                    </thead>
                </table>
            </section>
        </section>
    </main>
    <script>
        let dataTable;
        // 컬럼 별로 정렬하기 위해서 설정
        let dataColumns = [
            {data : 'brdId'},
            {data : 'title'},
            {data : 'writer'},
            {data : 'readCount'},
            {data : 'likeCount'},
            {data : 'modifiedDate'}
        ]
        // 받아오는 데이터 예시
        //{name : "1", title: "333"}
        function drawData() {
            table = $('#boardTable').DataTable({
                "order" :[
                    [0, 'desc']
                ],
                ajax : {
                    url : '/api/v1/board/data',
                    type : 'get',
                    data : function(d, settings) {
                        //dataTable api 객체
                        let api = new $.fn.dataTable.Api(settings);
                        d.page = api.page.info().page;   // 보여줄 페이지
                        d.size = api.page.info().length; //한페이지에 보여줄 개수
                        
                        let sidx = []; //정렬할 헤더
                        let sords = []; //정렬 방향
                        
                        for(let i = 0; i < api.order().length; i++) {
                            sidx.push(dataColumns[Number(api.order()[i][0])].data);
                            sords.push(api.order()[i][1]);
                        }

                        d.sidx = sidx.join(','); //컬럼
                        d.sord = sords.join(','); //정렬
                    },
                    dataFilter : function(data) {
                        let jsonData = $.parseJSON(data);  // json 객체를 일반객체로 변경

                        const dataObj = {};

                        dataObj.recordsTotal = jsonData.total;
                        dataObj.recordsFiltered = jsonData.total;
                        dataObj.data = jsonData.content;
                        return JSON.stringify(dataObj);
                    }
                },
                fixedHeader : true, // 테이블 헤더 고정
                deferRender : true, // 스크롤링을 위한 지연 랜더링
                scrollY : 542, // 스크롤 크기
                scrollX : true, // 가로 스크롤 여부
                scrollCollapse : true, //스크롤 영역 합치기
                scroller : true, // 스크롤 생성 할건지
                searching : false, // 자체 검색 기능 비활성화
                ordering: true, //정렬 기능 활성화
                info : true,  // 설명
                paging : true, // 페이징 처리 여부
                processing : true,
                serverSide : true,
                pagingType : 'full_numbers',
                lengthMenu : [10,30,50],
                displayLength : 10,
                columnDefs :[
                    {target:0, width: '10%'},
                    {target:[1], width: '30%',
                        render : function(data, type, row) {
                            return `<a href='/board/${row.brdId}'>${data}</a>`;
                        }
                    },
                    {target:[2], width: '20%'},
                    {target:[3], width: '10%'},
                    {target:[4], width: '10%'},
                    {target:[5], width: '20%'}
                ],
                columns : dataColumns
            });
        }

        const writeBoard = () => {
            location.href = '/board/add/form';
        }

        $(document).ready(function() {
            drawData();
        });
    </script>
</div>
</html>